---
title: "Procedure Data"
author: "Robert Feldstein"
date: "2025-02-26"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(openxlsx)
library(dplyr)

df <- read.xlsx("../Data/Procedures.xlsx", sheet = 1)
df

```

```{r}
# Castration and Ovarioectomy are the most important 

# Group by skill and get the count 

df %>% group_by(Skill) %>% summarise(Count = n()) %>% arrange(desc(Count))

```

Castration and Ovarioectomy are the most popular procedures. They will be important to track.



```{r}
# Group by skill and UniqueID

df %>% group_by(Unique.ID, Skill) %>% summarise(Count = n())

```

This is an individual list of procedures performed by each student. 

## Investigating Differences between 2024 and 2025 

```{r}

# Id's starting with 118 are in the class of 2025, and 1-117 are in the class of 2024

df$Class <- ifelse(as.numeric(substr(df$Unique.ID, 1, 3)) > 117, "2025", "2024")

# How about sum of count column

df %>% group_by(Class) %>% summarise(Count = sum(count, na.rm = TRUE))

```

As known by our client, students did not log nearly as many procedures in 2024 as they did in 2025. This is largely because the procedural tracker was not introduced until January. There were essentally 5000 more procedures logged in 2025 than in 2024. 



```{r}
# Which services have the most surgeries?

df %>% group_by(service) %>% summarise(Count = sum(count, na.rm = TRUE)) %>% arrange(desc(Count))

```
The class with the most surgeries is 5601.


```{r}
# What are the most popular categories of surgeries?

df %>% group_by(Category) %>% summarise(Count = sum(count, na.rm = TRUE)) %>% arrange(desc(Count))

# How many students have done each category of surgery?

df %>% group_by(Category) %>% summarise(Count = n()) %>% arrange(desc(Count))


```

```{r}
# Come up with some plots

library(ggplot2)

# Procedures by category, but break the colors into 2024 and 2025

ggplot(df, aes(x = Category, fill = Class)) + geom_bar() + theme(axis.text.x = element_text(angle = 45, hjust = 1))




```

```{r}
# Procedures by service, but break the colors into 2024 and 2025

ggplot(df, aes(x = service, fill = Class)) + geom_bar() + theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

```{r}
# Plot the distribution of the amount of procedures done by each student

ggplot(df, aes(x = Unique.ID, y = count)) + geom_point() + theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

```{r}
# Plot a distribution for each category

ggplot(df, aes(x = Category, y = count)) + geom_boxplot() + theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

```{r}
# Do a distribution by category for 2024 and 2025

ggplot(df, aes(x = Category, y = count, fill = Class)) + geom_boxplot() + theme(axis.text.x = element_text(angle = 45, hjust = 1))


```

