---
title: "Classification"
author: "MPS Group 11"
date: "2025-02-23"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(openxlsx)
library(dplyr)
df <- read.xlsx("../Data/FinalDataSet.xlsx")
# Add the time column 
labels <- c("A1", "A2", "A3", "A4", "A5", "A6", "A7", "B1", "B2", "B3", "B4", 
            "B5", "B6", "C1", "C2", "C3", "C4", "C5", "C6", "D1","D2", 
            "D3", "D4", "D5", "D6")

# Create a mapping of labels to integers
label_mapping <- setNames(1:length(labels), labels)

# Convert strBlock column to integers
df$time<- label_mapping[df$strBlock]
```
Logistic Regressions for Student Competency
1,2, & 3 = Incompetent; 4 & 5 = Competent Encoded as 0 = Incompetent; 1 = Competent 

<<<<<<< Updated upstream
## Basic Classification

The goal of this classifier is to use certain binary variables to determine the probability that a student's score is at least a 4 by time block D6. For now we will use Average score, but this model should be usable for any score. 


```{r}

# Predictive variables 
binary_vars <- c("Hosp", "Early", "PIPYN")

# Subset the dataset to only include rows where time = 25
df_time25 <- df %>% filter(time == 25)

df_time25$target <- ifelse(df_time25$Average >= 4, 1, 0)
target_var <- "target"

# Create a logistic regression model
model <- glm(paste(target_var, "~", paste(binary_vars, collapse = " + ")), data = df_time25, family = "binomial")

# Get the predicted probabilities
df_time25$pred <- predict(model, type = "response")

# Get the predicted classes
df_time25$pred_class <- ifelse(df_time25$pred >= 0.5, 1, 0)

summary(model)

# Get accuracy 
accuracy <- mean(df_time25$pred_class == df_time25$target)

```
Logistic Regressions for Student Competency
1,2, & 3 = Incompetent; 4 & 5 = Competent Encoded as 0 = Incompetent; 1 = Competent 


<<<<<<< Updated upstream




=======

=======
>>>>>>> Stashed changes
Logistic Regression for all attributes
```{r}
labels <- c("A1", "A2", "A3", "A4", "A5", "A6", "A7", "B1", "B2", "B3", "B4", 
            "B5", "B6", "C1", "C2", "C3", "C4", "C5", "C6", "D1","D2", 
            "D3", "D4", "D5", "D6")

# create a mapping of labels to integers
label_mapping <- setNames(1:length(labels), labels)

# convert strBlock column to integers
df$strBlockint<- label_mapping[df$strBlock]

attributes<- c("strBlockint","strBlock", "medical", "clinical_reasoning", "professionalism", "collaboration", "patient_care", "Average", "procedural", "oral", "written")
sample_df<- df[,attributes]

#convert scores into categories
sample_df<- sample_df |>
    mutate(across(-c(strBlock, strBlockint), ~ factor(
      ifelse(. %in% c(1,2,3), 0, 1), levels = c(0,1)) )) |>
  select(strBlock, strBlockint, everything())

#logistic regression for each attribute individually (along with Average)
log_models<- list()
for(i in 3:length(attributes)){
  attribute <- attributes[i]
  formula<- as.formula(paste(attribute, "~ strBlockint"))
  log_model<- glm(formula, family = "binomial", data = sample_df)
  log_models[[attribute]]<- summary(log_model)
}

```

Logistic Regression for Hospital Employees
```{r}
hosp_df<- df[,c("Hosp",attributes)]

#convert scores into categories
hosp_df<- hosp_df |>
    mutate(across(-c(Hosp,strBlock, strBlockint), ~ factor(
      ifelse(. %in% c(1,2,3), 0, 1), levels = c(0,1)) )) |>
  mutate(Hosp = factor(Hosp, levels = c(0,1)))|>
  select(strBlock, strBlockint,Hosp, everything())

#logistic regression for each attribute individually (along with Average)
log_models_hosp<- list()
for(i in 3:length(attributes)){
  attribute <- attributes[i]
  formula<- as.formula(paste(attribute, "~ Hosp + strBlockint"))
  log_model<- glm(formula, family = "binomial", data = hosp_df)
  log_models_hosp[[attribute]]<- summary(log_model)
}

```

Logistic Regression for Introductory Rotation Students
```{r}
early_df<- df[,c("Early",attributes)]

#convert scores into categories
early_df<- early_df |>
    mutate(across(-c(Early,strBlock, strBlockint), ~ factor(
      ifelse(. %in% c(1,2,3), 0, 1), levels = c(0,1)) )) |>
  mutate(Early = factor(Early, levels = c(0,1))) |>
  select(strBlock, strBlockint, Early, everything())

#logistic regression for each attribute individually (along with Average)
log_models_early<- list()
for(i in 3:length(attributes)){
  attribute <- attributes[i]
  formula<- as.formula(paste(attribute, "~ Early + strBlockint"))
  log_model<- glm(formula, family = "binomial", data = early_df)
  log_models_early[[attribute]]<- summary(log_model)
}
```
Logistic Regression for PIPs
```{r}
#Whether or not a student was ever in a PIP
pipyn_df<- df[,c("PIPYN",attributes)]

#convert scores into categories
pipyn_df<- pipyn_df |>
    mutate(across(-c(PIPYN,strBlock, strBlockint), ~ factor(
      ifelse(. %in% c(1,2,3), 0, 1), levels = c(0,1)) )) |>
  mutate(PIPYN = factor(PIPYN, levels = c(0,1))) |>
  select(strBlock, strBlockint, PIPYN, everything())

#logistic regression for each attribute individually (along with Average)
log_models_pip<- list()
for(i in 3:length(attributes)){
  attribute <- attributes[i]
  formula<- as.formula(paste(attribute, "~ PIPYN + strBlockint"))
  log_model<- glm(formula, family = "binomial", data = pipyn_df)
  log_models_pip[[attribute]]<- summary(log_model)
}
```
```{r}
#Whether a PIP was active/historical during a certain rotation block
pipActive_df<- df[,c("PIPActive",attributes)]

#convert scores into categories
pipActive_df<- pipActive_df |>
    mutate(across(-c(PIPActive,strBlock, strBlockint), ~ factor(
      ifelse(. %in% c(1,2,3), 0, 1), levels = c(0,1)) )) |>
  mutate(PIPActive = factor(PIPActive, levels = c(0,1))) |>
  select(strBlock, strBlockint, PIPActive, everything())

#logistic regression for each attribute individually (along with Average)
log_models_pip2<- list()
for(i in 3:length(attributes)){
  attribute <- attributes[i]
  formula<- as.formula(paste(attribute, "~ PIPActive + strBlockint"))
  log_model<- glm(formula, family = "binomial", data = pipActive_df)
  log_models_pip2[[attribute]]<- summary(log_model)
}

```
<<<<<<< Updated upstream
>>>>>>> Stashed changes
=======
>>>>>>> Stashed changes
